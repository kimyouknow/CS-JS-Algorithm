# 프론트와 백을 한 번에 배포

spring, django같은 웹 어플리케이션의 동작원리를 살펴보자

쉽게 말해, `프론트엔드와 백엔드가 분리되기 전의 배포는 프론트엔드가 백엔드 배포에 종속 되어 서버가 유저가 요구하는 모든 리소스를 보내주던 시절의 웹개발`

> 클라이언트가 요청을 보내면 서버에 존재하는 웹 어플리케이션 데이터베이스와 서버와 통신하여 필요한 데이터를 가져오고, 해당 데이터를 가지고 html,css,js 파일들을 만들어서 클라이언트에게 제공

# 프론트와 백을 분리해서 배포

> 정적리소스를 호스팅해 틀(frame) 역할을 하고 백앤드 서버에서 api를 통해 불러온 데이터들로 그 틀을 내용(content)로 채운다.

프론트는 정적 정적 리소스(html,css,js)을 정적 웹사이트 호스팅 한다. s3같은 곳에 정적인 파일들을 업로드 해놓으면 정해진 url로 요청을 보냈을 때 해당 파일들을 전송해주는 프론트 서버로서의 기능을 제공한다는 뜻이다.

반면 백에서는 api 호출을통해 동적인 데이터를 불러온다. 정적인 파일들을 저장하는 s3가 아닌 백앤드 서버를 통해 별도로 제공한다.

### 프론트 서버?

프론트엔드 개발자도 서버를 다룬다. 보통 웹에서 서버는 프론트엔드 서버와 백앤드 서버로 나눈다. `프론트 엔드 서버`는 웹 페이지에 `렌더링`하는 데에 필요한 Html,css js 파일(`정적 리소스`)을 브라우저에게 전송하는 역할을 담당하고 `백앤드 서버`는 웹페이지에 필요한 `동적인 데이터`들을 생성하고 전송하는 역할을 한다.

우리가 만든 서비스를 배포한다면, 해당 파일들을 프론트 서버나 백앤드 서버로 올라가고, 주소창에 url을 입력하면 프론트 서버에 저장된 파일들을 전송받아서 웹페이지로 불러오게 되는 것이다. 렌더링 방식에 따라 차이가 있는데 다음과 같다.

### CSR방식으로 배포

> 웹 페이지 기본 화면인 정적 웹페이지를 받아 올 때는 클라이언트(브라우저) <-> 프론트 앤드 서버가 소통
> api요청을 할 때는 클라이언트(브라우저) <->백앤드 서버 <-> 데이터 베이스가 소통

### 통신과정

![R1280x0](https://user-images.githubusercontent.com/71386219/156090279-6bf7af09-9e1e-4222-ac79-e879c01faf67.png)

### SSR방식으로 배포

> 클라이언트(브라우저) <-> 프론트엔드 서버 <-> 백앤드 서버 <-> 데이터 베이스

### 통신과정

![R1280x0-2](https://user-images.githubusercontent.com/71386219/156090289-1c2a8920-d349-4a19-9db4-3062f0dd59b4.png)

# CSR

- 클라이언트측에서 렌더링을 하는 것
- 보통 프론트 서버에서 직접 받아오지 않고 amazion cloundfront같은 cdn을 통해 받아오는 경우가 많다.
- 렌더링 과정에서 db데이터가 필요하면 브라우저는 백앤드 서버로 api 요청을 보내서 필요한 데이터를 받아온다.
- 첫 페이지 로딩 시간이 느리지만 이후 나머지 페이지 전환이 빠르다.
- 처음 html은 뼈대만 seo에 취약

### 렌더링 과정

![R1280x0-3](https://user-images.githubusercontent.com/71386219/156091274-58d66d57-2b3b-48ef-942b-b101ab1d2e34.png)

# SSR

- 서버에서 html,css파싱을 완료하고 결과물을 클라이언트에 전송
- 프론트서버에 html,css,js 파일을 직접 올리지 않는다.
- 해당 파일들을 만들어낼 수 있는 로직을 올리고 서버에서 해당 로직을 실행
- 그 결과로 생성된 바로 렌더링할 수 있는 html파일을 클라이언트로 전송, 클라이언트는 해당 파일을 받아 바로 렌더링
- 이후 js파일을 받아서 실행.
- 첫 페이지 로딩은 빠르지만 이후 페이지 전환이 느라다.
- seo에 유리

### 렌더링 과정

![R1280x0-4](https://user-images.githubusercontent.com/71386219/156091281-4893a626-00a9-4ca8-9990-a4c4d5af88b8.png)

## 기존의 페이지 덩어리(JSP/Servlet)를 'CSR View 영역'과 'SSR View 영역', 그리고 'API'로 분리함으로써 프런트엔드와 백엔드 영역에서 담당하는 페이지의 역할을 나누기

> [어서 와, SSR은 처음이지? - 도입 편](https://d2.naver.com/helloworld/7804182)해당 글의 내용을 아~~~~주 간단히 필요한 부분만 가져왔다. 자세한 내용은 해당 글을 꼭! 읽어야한다.

## SPA 방식으로 다음과 같이 분리

![spa전환](https://user-images.githubusercontent.com/71386219/158130986-884dc45c-b032-4ea9-8000-d03165d73a8b.png)

## SSR 방식으로 다음과 같이 분리

기존에 CSR 페이지는 프런트엔드에서 개발하고 SSR 페이지는 백엔드에서 개발을 했다면, SSR 환경을 구축하면 페이지의 소유권이 온전히 프런트엔드에 존재하므로 페이지가 변경될 때마다 불필요한 커뮤니케이션을 할 필요가 없어진다.

![ssr전환](https://user-images.githubusercontent.com/71386219/158130995-3f82ba5b-e7cf-4d98-bf50-3227fbabf7a7.png)

# 요약 정리

```
프론트 서버가 웹 서버이고 백엔드 서버는 API 서버로 생각

기본 화면만을 받아올 때는 클라이언트(브라우저) <-> 프론트엔드 서버

SSR을 할 때는 클라이언트(브라우저) <-> 프론트엔드 서버 <-> 백엔드 서버 <-> DB

API 요청을 할 때는 클라이언트(브라우저) <-> 백엔드 서버 <-> DB
```

🔍 참고자료

- [React 프론트 엔드와 백 엔드 분리 시 동작 원리 (vs 풀 스택) - tistory](https://it-eldorado.tistory.com/85)
- [프론트 배포를 위한 잡다한 사전 지식](https://iborymagic.tistory.com/94)
- [프론트엔드 개발자의 인프라 공부](https://maxkim-j.github.io/posts/frontend-infrastructure)
- [어서 와, SSR은 처음이지? - 도입 편](https://d2.naver.com/helloworld/7804182)
