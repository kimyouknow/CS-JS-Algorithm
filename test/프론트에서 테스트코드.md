해당 글은 테스트 코드를 작성하기 전 무엇을 테스트해야하는지에 대한 내용을 담고 있다. 아래 참고자료의 내용을 정리한 수준이니 자세한 내용은 아래 참고자료를 확인해야한다.

# 한 번에 TDD를 적용하기 어렵다

TDD가 무엇인지 알기 전에 브라우저에서 무엇을 테스트해야할지, 왜 해야하는지 알기 어렵다. 테스트 대상과 이유, 목적을 알고 있더라도 TDD를 한 번에 적용하기 어려울 수 있다.

아직 제대로 공부도 안해보고 걱정만 한다고 느껴질 수도 있지만, 학습하는 사람의 입장에서 우선 기능 구현과 기술에 대한 학습을 우선시해야한다고 느껴 다음과 같은 방법을 선택해봤다.

## TDD보다는 기능 구현이후 완성된 코드에 대한 테스트 케이스 추가하기

테스트를 일종의 스펙의 관점에서 바라본다는 [[OKKYCON: 2018] 이혜승 - 테알못 신입은 어떻게 테스트를 시작했을까?](https://youtu.be/1bTIMHsUeIk) 유튜브 영상을 참고했다. 내가 짠 코드의 스펙을 하나씩 추가하는 방식으로 완성된 코드는 남겨두고, 테스트 케이스를 하나씩 작성해보려고한다.

> 예상 코드 → 성공 코드 → 원래 함수 리팩토링 → 테스트 케이스 추가

# 어떤 코드를 테스트할까?

## 테스트 하기 쉬운 코드

utils, hooks 등의 순수함수

## 테스트 하기 어려운 코드

중요도가 높은 비즈니스 로직이 포함된 부분

버그가 발견된 부분

결합이 낮고 논리는 복잡한 부분

## 테스트 대상

### **시각적 요소**

- 마크업 시각화
- jest의 snaphot, storybook을 통한 시각화

### **사용자 이벤트 처리**

- 이벤트를 적절한 이벤트 핸들러로 처리하는 작업

### **API통신**

- 브라우저 API 또는 라이브러리를 활용하여 API 서버와 통신하고 애플리케이션 상태를 동기화하는 작업

## 불필요한 테스트 대상

비즈니스와 관련된 버그를 낼 가능성이 적은 코드

테스트가 단언하고 있는 내용이 사용자에게 중요한 가치를 주는 것이 아닐 때 (html 태그 속성 )

DOM 구조는 변경될 가능성이 높아 깨지기 쉽다. 또한, 사용자에게 주는 가치가 상대적으로 낮다.

# 무엇에 대한 테스트를 만들어야할까?

기본적인 원칙은 `테스트 유지보수하는 비용 < 테스트 유지와 관리에 드는 이익` 이다.

## 1. 동작에 집중하기

정적인 UI는 잠시 미뤄두고 동적인 동작에 집중해야한다. 화면에 dom이 잘 렌더링될지, 내가 onClick props로 등록한 이벤트가 제대로 발생할지는 사용하고 있는 플랫폼(react)를 믿자. 이 부분에 대한 단위테스트는 넘어가고 비즈니스로직에 집중하자.

예를 들어, 사용자가 버튼을 클릭했을 때, 이벤트가 발생하여 어떠한 **부수 효과(side effect)를 가져오는가**를 테스트 한다. 버튼을 클릭하여 어떤 컴포넌트의 상태가 변경될 수 있고 다른 페이지로 이동할 수도 있고 상태에 따라 모달 컴포넌트가 보이게 될 수도 있다.

정적인 UI는 storybook으로 위임할 수도 있다.

## 2. 유저의 관점에서 비즈니스 로직을 테스트하기

## 3. **비즈니스 로직과 UI 렌더링의 분리**

UI 렌더링 코드에 비즈니스 로직이 들어간다면, 해당 부분을 테스트하기 어려울 것이다. 비즈니스 로직을 Hooks나 utils로 관리하고 컴포넌트는 화면을 그리는 역할에만 집중하도록 해보자.

## 4. 상태 변수 및 DOM Tree는 건들지 마라

좋은 테스트의 조건 중 하나는 "`내부 구현 변경 시 깨지지 않아야 한다`"이다. 즉 테스트를 할 때는 결괏값을 "어떻게" 만들어내는지가 아니라 결과물이 "무엇"인지를 검증해야 한다.

Testing Library를 사용한다면 상태 변수에 접근하지 않는다. prop으로 전달된 함수를 테스트하긴 할 것이지만, 상태 변수가 정확한 값을 가지고 있는지는 테스트하지 않는다. 상태 관리는 컴포넌트의 구현 세부사항(implementation detail)이다. 상태 변수가 지금은 컴포넌트에 있지만 부모로 옮겨질 수도 있고 그렇게 해도 앱은 똑같이 동작해야 한다.

DOM요소도 마찬가지이다. 세부적인 DOM요소에 특정 데이터가 있지는 테스트하는 코드는 DOM요소가 바뀌거나 추가되면서 언제든지 깨질 수 있다. (이와 같이 HTML이나 CSS를 리팩토링할 때에도 테스트 코드를 갱신시켜주어야 하며, 이로 인해 개발 속도가 오히려 느려지는 결과를 가져올 수 있다.)

# 그 외 팁

- 테스트에서 뭐가 일어나고 있는지 확실하지 않을 때는 언제나 `screen.debug()`를 사용해라.
- 혹시나DOM 트리에서 요소에 접근할 때 `getByRole`, `findByRole`, … 함수를 사용해라.

# 참고자료

TDD에 대한 생각

[https://meetup.toast.com/posts/174](https://meetup.toast.com/posts/174)

[https://ui.toast.com/weekly-pick/ko_20210630](https://ui.toast.com/weekly-pick/ko_20210630)

[https://jbee.io/react/testing-0-react-testing-intro/](https://jbee.io/react/testing-0-react-testing-intro/)

[https://blog.rhostem.com/posts/2020-10-14-beginners-guide-to-testing-react-1](https://blog.rhostem.com/posts/2020-10-14-beginners-guide-to-testing-react-1)

[[OKKYCON: 2018] 이혜승 - 테알못 신입은 어떻게 테스트를 시작했을까?](https://youtu.be/1bTIMHsUeIk)
