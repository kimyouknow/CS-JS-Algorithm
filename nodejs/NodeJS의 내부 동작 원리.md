> ì•„ë˜ ì°¸ê³ ìë£Œì˜ ê¸€ë“¤ì„ ë³µì‚¬í•´ì„œ ì •ë¦¬í•œ ìˆ˜ì¤€ì´ë‹¤. ë‹¤ì‹œ ì´í•´í•˜ê³  ì •ë¦¬í•  í•„ìš”ê°€ ìˆë‹¤.

# NodeJsì˜ ë‚´ë¶€ ë™ì‘ ì›ë¦¬

> libuv, ì´ë²¤íŠ¸ë£¨í”„, ì›Œì»¤ì“°ë ˆë“œ, ë¹„ë™ê¸°, ì´ë²¤íŠ¸ ê¸°ë°˜, ë…¼ë¸”ë¡œí‚¹,ì‹±ê¸€ ìŠ¤ë ˆë“œ

javascriptì˜ ë™ì‘ì›ë¦¬ì— ëŒ€í•œ ì‚¬ì „ì§€ì‹ì´ í•„ìš”í•˜ë‹¤.

ğŸ“Œ ëª©ì°¨

1. NodeJs ë€?
2. NodeJs êµ¬ì„±
3. ì´ë²¤íŠ¸ ë£¨í”„ë€?
4. NodeJsì˜ ë¹„ë™ê¸° ì²˜ë¦¬

# NodeJsë€?

> ë¹„ë™ê¸° ì´ë²¤íŠ¸ ì£¼ë„ JavaScript ëŸ°íƒ€ì„ìœ¼ë¡œì¨ Node.js ëŠ” í™•ì¥ì„± ìˆëŠ” ë„¤íŠ¸ì›Œí¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ ìˆ˜ ìˆë„ë¡ ì„¤ê³„ëœ ì–¸ì–´ë‹¤.

ìì„¸í•œ ë‚´ìš©ì€ ëª©ì°¨ì˜ `NodeJSë€?` ì— ì°¸ê³ í•˜ê¸°.

# NodeJS êµ¬ì„±

Node.jsë¥¼ í¬ê²Œ ë‚˜ëˆ ë´¤ì„ ë•Œ, `ë‚´ì¥ ë¼ì´ë¸ŒëŸ¬ë¦¬`ì™€ `v8ì—”ì§„` ê·¸ë¦¬ê³  `libuv`ë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤. Node.jsì˜ íŠ¹ì„±ì¸ ì´ë²¤íŠ¸ ê¸°ë°˜, ë…¼ë¸”ë¡œí‚¹ I/O ëª¨ë¸ë“¤ì€ ëª¨ë‘ libuv ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ êµ¬í˜„ëœë‹¤.

![libuv](./image/libuv.png)

# libuv

libuvë€ node.jsì—ì„œ ì‚¬ìš©í•˜ëŠ” `ë¹„ë™ê¸° I/O ë¼ì´ë¸ŒëŸ¬ë¦¬`ë‹¤. node.jsì˜ íŠ¹ì„±ì¸ ì´ë²¤íŠ¸ ê¸°ë°˜, `ë…¼ ë¸”ë¡œí‚¹ I/O ëª¨ë¸`ì€ ëª¨ë‘ libuvì—ì„œ êµ¬í˜„ëœë‹¤. ì½œë°± í•¨ìˆ˜ë“¤ì€ libuv ë‚´ì— ìœ„ì¹˜í•œ `ì´ë²¤íŠ¸ ë£¨í”„`ì—ì„œ ê´€ë¦¬ ë° ì²˜ë¦¬ëœë‹¤.

ì£¼ìš”íŠ¹ì§•ì„ ìš”ì•½í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

- `libuv`ëŠ” ìš´ì˜ì²´ì œì˜Â ì»¤ë„ì„ ì¶”ìƒí™”í•´ì„œ ë¹„ë™ê¸° APIë¥¼ ì§€ì›í•œë‹¤.
- `libuv`ëŠ” ì»¤ë„ì´ ì–´ë–¤Â ë¹„ë™ê¸° APIë¥¼ ì§€ì›í•˜ê³  ìˆëŠ”ì§€ ì•Œê³  ìˆë‹¤.
- ë§Œì•½ ì»¤ë„ì´ ì§€ì›í•˜ëŠ” ë¹„ë™ê¸° ì‘ì—…ì„Â `libuv`ì—ê²Œ ìš”ì²­í•˜ë©´Â `libuv`ëŠ” ëŒ€ì‹  ì»¤ë„ì—ê²Œ ì´ ì‘ì—…ì„Â ë¹„ë™ê¸°ì ìœ¼ë¡œ ìš”ì²­í•´ì¤€ë‹¤.
- ë§Œì•½ ì»¤ë„ì´ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¹„ë™ê¸° ì‘ì—…ì„Â `libuv`ì—ê²Œ ìš”ì²­í•˜ë©´Â `libuv`ëŠ” ë‚´ë¶€ì— ê°€ì§€ê³ ìˆëŠ”Â ìŠ¤ë ˆë“œ í’€ì—ê²Œ ì´ ì‘ì—…ì„ ìš”ì²­í•´ì¤€ë‹¤.
- `libuv`ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ 4ê°œì˜ ìŠ¤ë ˆë“œë¥¼ ê°€ì§€ëŠ”Â ìŠ¤ë ˆë“œ í’€ì„ ìƒì„±í•œë‹¤

### ì´ë²¤íŠ¸ ê¸°ë°˜ì´ë€?

- node.jsëŠ” ì½œ ìŠ¤íƒ, ì´ë²¤íŠ¸ íì— í•­ìƒ ëª…ë ¹ì„ ëŒ€ê¸°ì‹œí‚¤ì§€ ì•Šê³  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆevent listenerë¥¼ í†µí•´`ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ì½œë°±í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ëŠ” ë°©ì‹`ì„ ì‚¬ìš©í•œë‹¤.
- ì´ë²¤íŠ¸ê°€ ë°œìƒí•  ë•Œ ë¯¸ë¦¬ ì§€ì •í•´ë‘” ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë°©ì‹ì„ ì˜ë¯¸í•œë‹¤. Node.jsëŠ” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆì— ë“±ë¡í•´ë‘” ì½œë°±í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë™ì‘. (í”íˆ ì‚¬ìš©í•˜ê³  ìˆëŠ”`routerë„ ì´ë²¤íŠ¸ ê¸°ë°˜`ìœ¼ë¡œ ë™ì‘)

### ë…¼ ë¸”ë¡œí‚¹ I/Oì´ë€?

- Node.jsëŠ” ì‹±ê¸€ìŠ¤ë ˆë“œ ë…¼ë¸”ë¡œí‚¹ ëª¨ë¸ë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤. í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œë¡œ ë™ì‘í•˜ì§€ë§Œ, ë¹„ë™ê¸° I/O ì‘ì—…ì„ í†µí•´ ìš”ì²­ë“¤ì„ ì„œë¡œ ë¸”ë¡œí‚¹í•˜ì§€ ì•Šë‹¤. ì¦‰, ë™ì‹œì— ë§ì€ ìš”ì²­ë“¤ì„ ë¹„ë™ê¸°ë¡œ ìˆ˜í–‰í•¨ìœ¼ë¡œì¨ ì‹±ê¸€ìŠ¤ë ˆë“œì¼ì§€ë¼ë„ ë…¼ë¸”ë¡œí‚¹ì´ ê°€ëŠ¥í•˜ë‹¤.
- Inputê³¼ Outputì´ ê´€ë ¨ëœ ì‘ì—…(http, Database CRUD, third party api, filesystem) ë“±ì˜ ë¸”ë¡œí‚¹ ì‘ì—…ë“¤ì„ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìˆ˜í–‰í•˜ê³ , ì´ë¥¼ ë¹„ë™ê¸° ì½œë°±í•¨ìˆ˜ë¡œ ì´ë²¤íŠ¸ ë£¨í”„ì— ì „ë‹¬í•œë‹¤.
- ë°±ê·¸ë¼ìš´ë“œ: OperatingSystem ì»¤ë„ í˜¹ì€ libuvì˜ ìŠ¤ë ˆë“œ í’€

![os](./image/os.png)

# ì´ë²¤íŠ¸ ë£¨í”„ë€?

`ì´ë²¤íŠ¸ì— ë”°ë¼ í˜¸ì¶œë˜ëŠ” ì½œë°±í•¨ìˆ˜ë¥¼ ê´€ë¦¬`í•˜ëŠ” ê²ƒì´ ë°”ë¡œ ì´ë²¤íŠ¸ ë£¨í”„ë‹¤. ì´ë²¤íŠ¸ ë£¨í”„ëŠ” ì—¬ëŸ¬ ê°œì˜ `í˜ì´ì¦ˆ(Phase)`ë“¤ì„ ê°–ê³  ìˆìœ¼ë©° ê° phase ë“¤ì€ `FIFO í`ë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©°, ì´ íì—ëŠ” íŠ¹ì • ì´ë²¤íŠ¸ì˜ ì½œë°±ë“¤ì„ ë„£ê³ , CPUê°€ í• ë‹¹(=ì´ë²¤íŠ¸ë£¨í”„ê°€ í•´ë‹¹ phaseë¥¼ í˜¸ì¶œí• ë•Œ)ë  ë•Œ ì‹¤í–‰í•œë‹¤.

ì´ë²¤íŠ¸ ë£¨í”„ëŠ” `ë¼ìš´ë“œ ë¡œë¹ˆ(round-robin)` ë°©ì‹ìœ¼ë¡œ ë…¸ë“œ í”„ë¡œì„¸ìŠ¤ê°€ ì¢…ë£Œë ë•Œê¹Œì§€ ì¼ì • ê·œì¹™ì— ë”°ë¼ `ì—¬ëŸ¬ê°œì˜ í˜ì´ì¦ˆë“¤ì„ ê³„ì† ìˆœíšŒ`í•œë‹¤.

> ì•„ë˜ëŠ” Node.js ê³µì‹ í™ˆí˜ì´ì§€ì— ë‚˜ì™€ ìˆëŠ” ë¡œë¹ˆ í”„ë¡œì„¸ìŠ¤ ìŠ¤ì¼€ì¤„ë§ì— ëŒ€í•œ ì„¤ëª…ì´ë‹¤.

ê·¸ë£¹ ë‚´ì— ìˆëŠ” ëª¨ë“  ìš”ì†Œë“¤ì„ í•©ë¦¬ì ì¸ ìˆœì„œì— ì…ê°í•˜ì—¬ ë½‘ëŠ” ë°©ë²•ìœ¼ë¡œì„œ, ëŒ€ê°œ ë¦¬ìŠ¤íŠ¸ì˜ ë§¨ ìœ„ì—ì„œ ì•„ë˜ë¡œ ê°€ë©° í•˜ë‚˜ ì”© ë½‘ê³ , ëë‚˜ë©´ ë‹¤ì‹œ ë§¨ ìœ„ë¡œ ëŒì•„ê°€ëŠ” ì‹ìœ¼ë¡œ ì§„í–‰ëœë‹¤. ì‰½ê²Œ ë§í•´ ë¼ìš´ë“œ ë¡œë¹ˆì€ â€œê¸°íšŒë¥¼ ì°¨ë¡€ëŒ€ë¡œ ë°›ê¸°â€ë¼ê³  ì´í•´í•´ë„ ì¢‹ì„ ê²ƒì´ë‹¤. ì»´í“¨í„° ìš´ì˜ì—ì„œ, ì»´í“¨í„° ìì›ì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê¸°íšŒë¥¼ í”„ë¡œê·¸ë¨ í”„ë¡œì„¸ìŠ¤ë“¤ì—ê²Œ ê³µì •í•˜ê²Œ ë¶€ì—¬í•˜ê¸° ìœ„í•œ í•œ ë°©ë²•ìœ¼ë¡œì„œ, ê° í”„ë¡œì„¸ìŠ¤ì— ì¼ì •ì‹œê°„ì„ í• ë‹¹í•˜ê³ , í• ë‹¹ëœ ì‹œê°„ì´ ì§€ë‚˜ë©´ ê·¸ í”„ë¡œì„¸ìŠ¤ëŠ” ì ì‹œ ë³´ë¥˜í•œ ë’¤ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ì—ê²Œ ê¸°íšŒë¥¼ ì£¼ê³ , ë˜ ê·¸ ë‹¤ìŒ í”„ë¡œì„¸ìŠ¤ì—ê²Œ í•˜ëŠ” ì‹ìœ¼ë¡œ, ëŒì•„ê°€ë©° ê¸°íšŒë¥¼ ë¶€ì—¬í•˜ëŠ” ìš´ì˜ë°©ì‹ì´ ìˆëŠ”ë°, ì´ë¥¼ í”íˆ ë¼ìš´ë“œ ë¡œë¹ˆ í”„ë¡œì„¸ìŠ¤ ìŠ¤ì¼€ì¤„ë§ì´ë¼ê³  ë¶€ë¥¸ë‹¤.

## ì´ë²¤íŠ¸ ë£¨í”„ì˜ phaseë“¤ ì„¤ëª…

Node.jsê°€ ì‹œì‘ë˜ë©´ ìŠ¤ë ˆë“œê°€ ìƒê¸°ê³ , ì´ë²¤íŠ¸ ë£¨í”„ê°€ ìƒì„±ëœë‹¤. **ì´ë²¤íŠ¸ ë£¨í”„ëŠ” 6ê°œì˜ í˜ì´ì¦ˆë¥¼ ë¼ìš´ë“œ ë¡œë¹ˆ ë°©ì‹ìœ¼ë¡œ ìˆœíšŒí•˜ë©° ë™ì‘í•œë‹¤. ê° í˜ì´ì¦ˆëŠ” ìì‹ ë§Œì˜ íë¥¼ í•˜ë‚˜ì”© ê°€ì§€ê³  ìˆë‹¤.**

ê°„ë‹¨í•˜ê²Œ ìš”ì•½í•˜ìë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

- **ì´ë²¤íŠ¸ ë£¨í”„ëŠ”Â `Node.js`ê°€ ë¹„ë™ê¸° ì‘ì—…ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•œ êµ¬í˜„ì²´ë‹¤.**
- **ì´ë²¤íŠ¸ ë£¨í”„ëŠ” ì´ 6ê°œì˜ í˜ì´ì¦ˆë¡œ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©° í•œ í˜ì´ì¦ˆì—ì„œ ë‹¤ìŒ í˜ì´ì¦ˆë¡œ ë„˜ì–´ê°€ëŠ” ê²ƒì„ í‹±ì´ë¼ê³  í•œë‹¤.**
- **ê° í˜ì´ì¦ˆëŠ” ìì‹ ë§Œì˜ íë¥¼ ê´€ë¦¬í•œë‹¤.**
- **`Node.js`ëŠ” ìˆœì„œëŒ€ë¡œ í˜ì´ì¦ˆë¥¼ ë°©ë¬¸í•˜ë©´ì„œ íì— ìŒ“ì¸ ì‘ì—…ì„Â í•˜ë‚˜ì”©Â ì‹¤í–‰í•œë‹¤.í˜ì´ì¦ˆì˜ íì— ë‹´ê¸´ ì‘ì—…ì„ ëª¨ë‘ ì‹¤í–‰í•˜ê±°ë‚˜Â ì‹œìŠ¤í…œì˜ ì‹¤í–‰ í•œë„ì— ë‹¤ë‹¤ë¥´ë©´Â `Node.js`ëŠ” ë‹¤ìŒ í˜ì´ì¦ˆë¡œ ë„˜ì–´ê°„ë‹¤.**
- **ì´ë²¤íŠ¸ ë£¨í”„ê°€ ì‚´ì•„ìˆëŠ” í•œÂ `Node.js`ëŠ” ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ ë°˜ë³µí•œë‹¤.**

ì´ì œ ê°ê°ì˜ í˜ì´ì¦ˆë“¤ì´ ì„¸ë¶€ì ìœ¼ë¡œ ì–´ë–¤ ì—­í• ì„ ìˆ˜í–‰í•˜ëŠ”ì§€ì— ì•Œì•„ë³´ì.

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€>â”‚ timers â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”‚ pending callbacks â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”‚ idle, prepare â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ incoming: â”‚
â”‚ â”‚ poll â”‚<â”€â”€â”€â”€â”€â”¤ connections, â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ data, etc. â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â”‚ check â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”¤ close callbacks â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### `timers`

setTimeout, setInterval ê°™ì€ timer í•¨ìˆ˜ë“¤ì´ ì²˜ë¦¬ëœë‹¤. **ì´ë²¤íŠ¸ ë£¨í”„ê°€ í˜ì´ì¦ˆë¥¼ ìˆœíšŒí•˜ë©´ì„œ timer ë‹¨ê³„ì— ì˜¤ë©´ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” timer í•¨ìˆ˜ë“¤ì„ í™•ì¸í•˜ê³  ì½œë°±í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œë‹¤**. `timer í•¨ìˆ˜ì˜ ì…ë ¥ëœ ì§€ì—°ì‹œê°„`ì€ ì½œë°±í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ëŠ” ì •í™•í•œ ê°’ì´ ì•„ë‹Œ, ë‹¨ì§€ í•´ë‹¹ ì§€ì—°ì‹œê°„ ì´í›„ì— ì‹¤í–‰ëœë‹¤ëŠ” ì˜ë¯¸ë‹¤.

ë”°ë¼ì„œ, íƒ€ì´ë¨¸ ì½œë°±ì€ ì§€ì •ëœ ì‹œê°„ì´ ê²½ê³¼í•œ í›„ ì˜ˆì•½í•  ìˆ˜ ìˆëŠ” í•œ ë¹¨ë¦¬ ì‹¤í–‰í•œë‹¤. ë‚´ë¶€ë¡œì§ì€ pollíì— ë¨¼ì € ë“±ë¡ëœ ì½œë°±ë“¤ì´ ì²˜ë¦¬ë˜ê³  ì‹¤í–‰ëœë‹¤.

### `pending callbacks`(I/O callbacks)

pending queueì— ë‹´ê²¨ ìˆëŠ” ì½œë°±ë“¤ì„ ê´€ë¦¬í•œë‹¤. **ì´ íì— ë‹´ê¸°ëŠ” ì½œë°±ë“¤ì€Â ì´ì „ ì´ë²¤íŠ¸ ë£¨í”„ ë°˜ë³µì—ì„œ ìˆ˜í–‰ë˜ì§€ ëª»í–ˆë˜ I/O ì½œë°±ë“¤ì´ë‹¤**. ì‹œìŠ¤í…œì˜ ì‹¤í–‰ í•œë„ ì œí•œì— ì˜í•´ íì— ìŒ“ì¸ ëª¨ë“  ì‘ì—…ì„ ì‹¤í–‰í•˜ì§€ ëª»í•˜ê³  ë‹¤ìŒ í˜ì´ì¦ˆë¡œ ë„˜ì–´ê°ˆ ìˆ˜ë„ ìˆë‹¤. ì´ë•Œ ì²˜ë¦¬í•˜ì§€ ëª»í•˜ê³  ë„˜ì–´ê°„ ì‘ì—…ë“¤ì„ ìŒ“ì•„ë†“ê³  ì‹¤í–‰í•˜ëŠ” í˜ì´ì¦ˆë‹¤.

I/O ì‘ì—…ì´ ì™„ë£Œë˜ë©´ ë‹¤ìŒë²ˆ ë£¨í”„ì— ì´ ë‹¨ê³„ì— ë“¤ì–´ì™€ìˆê²Œ ë˜ê³ , I/O ì‘ì—… ë¸”ë¡ë‚´ì˜ ì½œë°±í•¨ìˆ˜ë“¤ì„Â **poll ë‹¨ê³„ì˜ íë¡œ ë„˜ê²¨ì¤ë‹ˆë‹¤**

### `idle, prepare`

ë‚´ë¶€ì ìœ¼ë¡œë§Œ ì‚¬ìš©í•˜ë¯€ë¡œ ìƒëµ

### `poll`

> I/Oë¥¼ ì–¼ë§ˆë‚˜ ì˜¤ë˜ ë¸”ë¡í•˜ê³  í´ë§í•´ì•¼í•˜ëŠ”ì§€ ê³„ì‚°í•˜ê³ , poll íì— ìˆëŠ” ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•œë‹¤.

poll ë‹¨ê³„ëŠ” ìƒˆ I/Oì´ë²¤íŠ¸ ê²€ìƒ‰í•˜ê³ . i/Oê´€ë ¨ ì½œë°±(close ì½œë°±, íƒ€ì´ë¨¸ë¡œ ìŠ¤ì¼€ì¤„ë§ëœ ì½œë°±,setImmediate()ë¥¼ ì œì™¸í•œ ê±°ì˜ ëª¨ë“  ì½œë°±) ì‹¤í–‰í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë‹¤ìŒê³¼ ê°™ì€ ì½œë°±ë“¤ì´ ì‹¤í–‰ëœë‹¤.

- ë°ì´í„°ë² ì´ìŠ¤ì— ì¿¼ë¦¬ë¥¼ ë³´ë‚¸ í›„ ê²°ê³¼ê°€ ì™”ì„ ë•Œ ì‹¤í–‰ë˜ëŠ” ì½œë°±
- HTTP ìš”ì²­ì„ ë³´ë‚¸ í›„ ì‘ë‹µì´ ì™”ì„ ë•Œ ì‹¤í–‰ë˜ëŠ” ì½œë°±
- íŒŒì¼ì„ ë¹„ë™ê¸°ë¡œ ì½ê³  ë‹¤ ì½ì—ˆì„ ë•Œ ì‹¤í–‰ë˜ëŠ” ì½œë°±

poll phaseëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ì½œë°±ì„ ê´€ë¦¬í•œë‹¤.

- **\*poll**Â íê°€Â **ë¹„ì–´ìˆì§€ ì•Šë‹¤ë©´\***Â ì´ë²¤íŠ¸ ë£¨í”„ê°€ ì½œë°±ì˜ íë¥¼ ìˆœíšŒí•˜ë©´ì„œ íë¥¼ ë‹¤ ì†Œì§„í•˜ê±°ë‚˜ ì‹œìŠ¤í…œ ì˜ì¡´ì ì¸ í•˜ë“œ í•œê³„ì— ë„ë‹¬í•  ë•Œê¹Œì§€ ë™ê¸°ë¡œ ì½œë°±ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
- **\*poll**Â íê°€Â **ë¹„ì–´ìˆë‹¤ë©´\***Â ë‹¤ìŒ ì¤‘ í•˜ë‚˜ì˜ ìƒí™©ì´ ë°œìƒí•©ë‹ˆë‹¤.
  - ìŠ¤í¬ë¦½íŠ¸ê°€Â `setImmediate()`ë¡œ ìŠ¤ì¼€ì¤„ë§ë˜ì—ˆë‹¤ë©´ ì´ë²¤íŠ¸ ë£¨í”„ëŠ”Â **poll**Â ë‹¨ê³„ë¥¼ ì¢…ë£Œí•˜ê³  ìŠ¤ì¼€ì¤„ë§ëœ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´Â **check**Â ë‹¨ê³„ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.
  - ìŠ¤í¬ë¦½íŠ¸ê°€Â `setImmediate()`ë¡œ ìŠ¤ì¼€ì¤„ë§ë˜ì§€ ì•Šì•˜ë‹¤ë©´ ì´ë²¤íŠ¸ ë£¨í”„ëŠ” ì½œë°±ì´ íì— ì¶”ê°€ë˜ê¸°ë¥¼ ê¸°ë‹¤ë¦° í›„ ì¦‰ì‹œ ì‹¤í–‰í•©ë‹ˆë‹¤.

**poll**Â íê°€ ì¼ë‹¨ ë¹„ê²Œ ë˜ë©´ íƒ€ì´ë¨¸ê°€Â *ì‹œê°„ ì„ê³„ì ì— ë„ë‹¬í–ˆëŠ”ì§€*Â í™•ì¸í•  ê²ƒì´ë‹¤. ë§Œì•½, í•˜ë‚˜ ì´ìƒì˜ íƒ€ì´ë¨¸ê°€ ì¤€ë¹„ë˜ì—ˆë‹¤ë©´ ì´ë²¤íŠ¸ ë£¨í”„ëŠ” íƒ€ì´ë¨¸ì˜ ì½œë°±ì„ ì‹¤í–‰í•˜ê¸° ìœ„í•´Â **timers**Â ë‹¨ê³„ë¡œ ëŒì•„ê°„ë‹¤.

### `check`

> **poll**Â ë‹¨ê³„ê°€ ì™„ë£Œëœ ì§í›„ ì‚¬ëŒì´ ì½œë°±ì„ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ í•œë‹¤.

**`Poll phase`**ê°€ ì§€ë‚˜ë©´ ì´ë²¤íŠ¸ ë£¨í”„ëŠ” ë°”ë¡œÂ **`setImmediate()`**APIì˜ ì½œë°±ê³¼ ê´€ë ¨ì´ ìˆëŠ”Â **`Check phase`**
ì— ë“¤ì–´ì„œê²Œ ëœë‹¤. ì´ í˜ì´ì¦ˆì—ì„œëŠ” ë‹¤ë¥¸ í˜ì´ì¦ˆì™€ ë§ˆì°¬ê°€ì§€ë¡œ íê°€ ë¹„ê±°ë‚˜ ì‹œìŠ¤í…œ ì‹¤í–‰ í•œë„ ì´ˆê³¼ì— ë„ë‹¬í•  ë•Œê¹Œì§€ ê³„ì† í•´ì„œÂ **`setImmediate`**ì˜ ì½œë°±ë“¤ì„ ì‹¤í–‰í•œë‹¤.

### `close callbacks`

close ì´ë²¤íŠ¸ì— ë”°ë¥¸ ì½œë°±í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œë‹¤.Â `socket.on('close', ...)`Â ì´ë²¤íŠ¸ì— ë”°ë¥¸ ì½œë°±í•¨ìˆ˜ë¥¼ ì˜ˆë¡œ ë“¤ ìˆ˜ ìˆë‹¤.

## ì˜ˆì‹œ

```jsx
fs.readFile('my-file-path.txt', () => {
  setTimeout(() => {
    console.log('setTimeout');
  }, 0);
  setImmediate(() => {
    console.log('setImmediate');
  });
});
```

- fs.readFile ë¼ëŠ” ë¸”ë¡œí‚¹ì‘ì—…ì„ ë§Œë‚œ ì‹œì ì— ì´ë²¤íŠ¸ë£¨í”„ëŠ” ì›Œì»¤ì“°ë ˆë“œì—ê²Œ ì‘ì—…ì„ ë„˜ê¹€
- ì›Œí¬ì“°ë ˆë“œê°€ ì‘ì—…ì„ ì™„ë£Œí•œ ë’¤ I/O callbacks ì˜ì—­ì˜ íì— ì½œë°±ì„ ë“±ë¡
- ì´ë²¤íŠ¸ë£¨í”„ê°€ I/O callbacks ì˜ì—­ì„ ì‹¤í–‰í•  ë•Œ, ì½œë°±ì„ poll ì˜ì—­ì˜ íì— ë“±ë¡
- ì´ë²¤íŠ¸ë£¨í”„ê°€ poll ì˜ì—­ì„ ì‹¤í–‰í•  ë•Œ, íì— 1ê°œê°€ ìˆìœ¼ë¯€ë¡œ ì´ê±¸ ì‹¤í–‰í•¨.
- (ì½œë°±ë‚´ë¶€) 2ë¼ì¸ì—ì„œ setTimeout() ì´ë¯€ë¡œ ë‹¤ì‹œ timers ì˜ì—­ì— ë„£ê³  5ë¼ì¸ìœ¼ë¡œ ê°„ë‹¤.
- (ì½œë°±ë‚´ë¶€) 5ë¼ì¸ì—ì„œ setImmediate() ì´ë¯€ë¡œ check ì˜ì—­ì— ë„£ëŠ”ë‹¤.
- ì´ë²¤íŠ¸ë£¨í”„ê°€ poll íë¥¼ ë¹„ìš°ê³ , ë‹¤ìŒ ì‹¤í–‰ì˜ì—­ì¸ check ì˜ì—­ìœ¼ë¡œ ê°„ë‹¤. check ì˜ì—­ì˜ íì—ëŠ” ë“¤ì–´ìˆëŠ” â€™Bâ€™ë¥¼ ì½˜ì†”ì— ì°ëŠ”ë‹¤. check ì˜ì—­ì˜ íë¥¼ ë¹„ìš°ê³  ë‹¤ì‹œ whileë¬¸ì˜ ì‹œì‘ì§€ì ìœ¼ë¡œ ê°„ë‹¤.
- ì´ë²¤íŠ¸ë£¨í”„ê°€ timers ì˜ì—­ì„ í˜¸ì¶œí•œë‹¤. uv\_\_run_timers()ëŠ” setTimeout()ì˜ ì½œë°±ì„ pollíì— ë“±ë¡í•œë‹¤.
- ì´ë²¤íŠ¸ë£¨í”„ê°€ 2ë²ˆì§¸ë¡œ poll ì˜ì—­ì„ ì‹¤í–‰í•œë‹¤. íì— 1ê°œê°€ ìˆìœ¼ë¯€ë¡œ ì´ê±¸ ì‹¤í–‰í•˜ê³  â€™Aâ€™ë¥¼ ì°ëŠ”ë‹¤.
- node í”„ë¡œì„¸ìŠ¤ê°€ ë°˜í™˜ë˜ê³  ë

## nodejsì˜ ì˜¬ë°”ë¥¸ ì‚¬ìš©

ë”°ë¼ì„œ, ì²˜ë¦¬ ì‘ì—…ì´ cpuë¥¼ ë§ì´ ì†Œëª¨í•˜ê±°ë‚˜, ëŒ€ìš©ëŸ‰ íŒŒì¼ì„ ì²˜ë¦¬í•œë‹¤ë©´ Node.jsì—ì„œëŠ” í° ì•½ì ì´ë‹¤. ê·¸ëŸ¬ë‚˜ `IOì‘ì—…ì´ ë³„ë¡œ ì—†ëŠ” ì–´í”Œë¦¬ìºì´ì…˜`ì´ë‚˜ `ë‹¨ìœ„ ì‘ì—…ì´ ì§§ì€ ë©”ì‹œì§• ì–´í”Œë¦¬ìºì´ì…˜`ì˜ ê²½ìš° ê³ ì„±ëŠ¥ì„ ë³´ì¥í•œë‹¤.

### âœ… NodeëŠ” ë™ê¸°ë³´ë‹¤ ë¹„ë™ê¸° ë°©ì‹ì— ìµìˆ™í•´ì ¸ì•¼ í•œë‹¤.

## ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë° ê¸°ë³¸

1. ë¹„ë™ê¸° API ì‚¬ìš©

- ë¹„ë™ê¸° ì´ë²¤íŠ¸ ë°œìƒì‹œí‚¤ê³  ì™„ë£Œ ì—¬ë¶€ë¥¼ ì•Œ ìˆ˜ ìˆëŠ” callback ì •ì˜

1. ë™ê¸° -> ë¹„ë™ê¸° ì „í™˜

```jsx
// ë™ê¸°
const fs = require('fs');
let filenames = fs.readdirSync('.');
for (let i = 0; i < filenames.length; i++) {
  console.log(filenames[i]);
}
console.log('ready');
console.log('cna prorcess next job...');
// ì¶œë ¥ê²°ê³¼
// forë¬¸ì˜ console.log
// ready
// cna prorcess next job...

// ë¹„ë™ê¸°
const fs = require('fs');
fs.readdir('.', function (err, filenames) {
  for (let i = 0; i < filenames.length; i++) {
    console.log(filenames[i]);
  }
});
console.log('ready');
console.log('cna prorcess next job...');
// ì¶œë ¥ê²°ê³¼
// cna prorcess next job...
// forë¬¸ì˜ console.log
// ready
```

1. ë¹„ë™ê¸° í”„ë¡œê·¸ë¨ì—ì„œ ìˆœì°¨ì²˜ë¦¬

- ì¤‘ì²©ëœ callbackì„ í™œìš©í•˜ì—¬ ìˆœì„œê°€ ë³´ì¥ë˜ê²Œ ë§Œë“¤ê¸°
- í•˜ì§€ë§Œ ê³¼ë„í•˜ê²Œ ì‚¬ìš©í•˜ë©´ ì½”ë“œì˜ ê°€ë…ì„±ì´ ë–¨ì–´ì§€ë¯€ë¡œ `async` ëª¨ë“ˆ ì‚¬ìš©

## Node.jsì˜ ë³‘ë ¬ì²˜ë¦¬

ë¹„ë™ê¸° ë°©ì‹ì´ë¼ë„ Evnet Loopì—ì„œ ì²˜ë¦¬ë˜ëŠ” ì‘ì—…ì´ ê¸´ ì‹œê°„ì„ ìš”êµ¬í•  ë•ŒëŠ” ì„±ëŠ¥ì´ ì €í•˜ë  ìˆ˜ ìˆë‹¤. ì´ë¥¼ í•´ê²° í•˜ê¸° ìœ„í•´ `ì´ë²¤íŠ¸ë¥¼ ì˜ê²Œ ìª¼ê°œì–´ ë³‘ë ¬ ì²˜ë¦¬`í•´ì•¼í•œë‹¤.

ì¤‘ì²©ëœ Callback í•¨ìˆ˜ë¥¼ `Closure`ë¡œ ì‚¬ìš©í•˜ì—¬ ìì‹ ì˜ Scope ë¿ë§Œ ì•„ë‹ˆë¼ ì™¸ë¶€ í•¨ìˆ˜ì˜ Scopeë¥¼ ê°€ì§€ê²Œí•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´, `count`ë³€ìˆ˜ë¥¼ ë‘ì–´ í•˜ë‚˜ì˜ ì‘ì—…ì„ ë³‘ë ¬ì²˜ë¦¬í•˜ì—¬ ì–¸ì œ ì „ì²´ ì‘ì—…ì´ ì™„ë£Œë˜ëŠ”ì§€ ì•Œ ìˆ˜ ì—†ì„ ë•Œ, `callbackì´ ì „ë‹¬ëœ íšŸìˆ˜ë§Œí¼ countì— ì €ì¥`í•˜ê³  `ì‘ì—… ì™„ë£Œë  ë•Œë§ˆë‹¤ countë¥¼ í•˜ë‚˜ì”© ê°ì†Œí•˜ê²Œ í•œë‹¤.`. countê°€ 0ì´ë˜ë©´ ëª¨ë“  ì‘ì—… ì™„ë£Œë˜ì—ˆë‹¤ëŠ” ì˜ë¯¸ë¡œ ê°„ì£¼í•œë‹¤.

## Callbackì˜ í˜¸ì¶œì‹œì 

`Callbackì˜ ì‹œì ì„ ë‹¤ë¥¸ ì½”ë“œì™€ ê°™ì´ ìˆœì°¨ì ìœ¼ë¡œ ìƒê°í•˜ë©´ ì•ˆ ëœë‹¤`. -> ë™ê¸°ì ìœ¼ë¡œ ìƒê°í•˜ë©´ ì•ˆëœë‹¤ëŠ” ëœ»â—

ì˜ˆë¡œ ë“¤ì–´, ì½”ë“œìƒì˜ Callbackë¡œì§ì€ ê°€ìš´ë° ìœ„ì¹˜í•˜ì§€ë§Œ Runtimeì— ë“¤ì–´ê°€ë©´ ì™¸ë¶€ ë¡œì§ê³¼ Callbackì€ Event Loopì— ì˜í•´ ì²˜ë¦¬ë˜ì–´ ì–´ëŠ ê²ƒì´ ë¨¼ì € ì‹¤í–‰ë ì§€ ì•Œ ìˆ˜ ì—†ë‹¤.

## êµ¬ì²´ì ì¸ ê³¼ì •

1. ì½”ë“œê°€ í˜¸ì¶œ ìŠ¤íƒì— ìŒ“ì¸ í›„ ì‹¤í–‰í•˜ë˜ ê·¸ê²ƒì´ ë¹„ë™ê¸° ì‘ì—…ì´ë¼ë©´ ì´ë²¤íŠ¸ ë£¨í”„ëŠ” ë¹„ë™ê¸° ì‘ì—…ì„ ìœ„ì„í•œë‹¤.
2. Nodeë¥¼ êµ¬ì„±í•˜ëŠ” libuvëŠ” í•´ë‹¹ ë¹„ë™ê¸° ì‘ì—…ì´ OSì»¤ë„ì—ì„œ í•  ìˆ˜ ìˆëŠ” ê²ƒì¸ì§€, ì•„ë‹Œì§€(thead poolì—ì„œ ì²˜ë¦¬)ë¥¼ íŒë‹¨í•˜ì—¬ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ì²˜ë¦¬í•œë‹¤.
3. ë¹„ë™ê¸° ì‘ì—…ì„ ì²˜ë¦¬í•˜ê³  ì½œë°± í•¨ìˆ˜ë¥¼ ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ í†µí•´ íƒœìŠ¤í¬ íì— ë„˜ê²¨ì£¼ì¤€ë‹¤.
4. ì´ë²¤íŠ¸ ë£¨í”„ëŠ” ì½œìŠ¤íƒì— ìŒ“ì—¬ìˆëŠ” í•¨ìˆ˜ê°€ ì—†ì„ ë•Œì—, íƒœìŠ¤í¬ íì—ì„œ ëŒ€ê¸°í•˜ê³  ìˆë˜ ì½œë°±í•¨ìˆ˜ë¥¼ ì½œìŠ¤íƒìœ¼ë¡œ ë„˜ê²¨ì¤€ë‹¤.
5. ì½œìŠ¤íƒì— ìŒ“ì¸ ì½œë°±í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ê³ , ì½œìŠ¤íƒì—ì„œ ì œê±°ëœë‹¤.

### ì°¸ê³ ìë£Œ

[https://github.com/nodejs/node](https://github.com/nodejs/node)

[https://evan-moon.github.io/2019/08/01/nodejs-event-loop-workflow/](https://evan-moon.github.io/2019/08/01/nodejs-event-loop-workflow/)

[https://medium.com/@vdongbin/node-js-ë™ì‘ì›ë¦¬-single-thread-event-driven-non-blocking-i-o-event-loop-ce97e58a8e21](https://medium.com/@vdongbin/node-js-%EB%8F%99%EC%9E%91%EC%9B%90%EB%A6%AC-single-thread-event-driven-non-blocking-i-o-event-loop-ce97e58a8e21)

[https://nodejs.org/ko/docs/guides/event-loop-timers-and-nexttick/](https://nodejs.org/ko/docs/guides/event-loop-timers-and-nexttick/)

[https://www.korecmblog.com/node-js-event-loop/](https://www.korecmblog.com/node-js-event-loop/)

[https://medium.com/the-node-js-collection/what-you-should-know-to-really-understand-the-node-js-event-loop-and-its-metrics-c4907b19da4c](https://medium.com/the-node-js-collection/what-you-should-know-to-really-understand-the-node-js-event-loop-and-its-metrics-c4907b19da4c)
