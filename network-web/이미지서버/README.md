> db에는 어떤 데이터를 저장해야하는지? s3를 사용한다면, s3 url을 서버로 줘서 서버에서 url을 저장하는건가?

키워드

> s3, cdn

# 이미지 서버 vs 이미지 저장

지금은 이미지가 몇 개 없고 작아서 상관없지만 쿠팡처럼 이미지가 많거나 이미지가 적어도 크기가 큰 이미지를 다운받아야하는경우 이미지를 직접 db에 저장해서 쓰기보다 이미지서버를 활용하는게 좋다고 함.

> CDN에서 불러오는게 가장 효율이 좋다. 사용자와 가까운 데이터센터에 캐싱을 해주기 때문에 글로벌 서브스는 특히 더 좋다. 이미지를 직접 서버로 관리하시면 부하 문제도 고민을 해야하는데 S3를 사용하면 이런 고민이 없어짐. 직접 서버에서 관리한다하면 이미지 업로드/전처리 과정은 서버에 엄청난 부하를 줄 수 있음. Client에서 Server를 거치지 않고 Client에서 즉시 S3로 전송

❓ 쿠팡에서 사용한 이미지 서버 url을 복사해서 쓸려니까 403 (다른 도메인에서 호출)에러가 발생. 어쩔 수 없이 일단 images폴더를 이미지를 직접 저장 -> 이후 다시 이미지 서버 url 쓰니까 에러가 안남

- 생각해보면 이미지 서버도 어쨌든 하나의 서버인데 아무나 접근가능하게 하면 손해아닌가? cors걸어둬야 하는거 아닌가 싶다.

❓ size: memory size vs byte

쿠팡 네트워크를 보면 memeory size인데 내가 직접 이미지를 올리면 바이트. 이미지 서버로 올리면 size가 memory size던데,, 뭐지

- 직접 이미지 업로드
  <img width="722" alt="스크린샷 2022-03-14 오후 11 09 20" src="https://user-images.githubusercontent.com/71386219/158190905-43e7c480-c293-4a66-99e0-8ef97f4141f7.png">

- 쿠팡 이미지 서버 url
  <img width="727" alt="스크린샷 2022-03-14 오후 11 25 59" src="https://user-images.githubusercontent.com/71386219/158192650-8df90e04-a945-4951-90a6-2ea32eb7a25c.png">

## 전체적인 흐름

### 흐름1

`업로드`:프론트에서 s3로 바로 이미지 업로드 → 업로드가 성공적으로 이뤄지면 해당 url을 파싱해서 프로필 업데이트 api에 데이터로 넣어서 서버로 전달

`이미지 보여주기`: 프론트에서 프로필 관련 데이터 요청 → 서버에서 저장된 url 전달 → img.src에 포맷에 맞춰 넣기

### 흐름2:

`업로드:` 프론트에서 백앤드로 이미지 업로드 api 요청 → 서버에서 s3로 저장 후 url 프론트로 전달 → 프로필 업데이트 api에 받은 url과 데이터전달

`이미지 보여주기:` 위와 같음.
