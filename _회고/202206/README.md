# 6월 월간 회고

# 코드스쿼드

> OAuth, 로그인 유지, 서버상태관리,

## OAuth 이해

OAuth를 구현할 때면 늘 서버 분들이 하라는 대로 구현했다. 혹은 강의에서 하라는대로 따라쳤다. 적어도 두 세번은 OAuth를 구현했지만 늘 이해하지 못하고 넘어갔다. 수동적인 자세로 구현하다보니 새로운 문제를 마주하게 되면 다른 사람이 해결해주길 기다리고, 비슷한 상황을 겪은 블로그 글들을 찾기 바빴다.

어렵다고 그냥 넘어가면 앞으로도 이해하지 못할 것 같아서 이번 기회에 express를 활용해 local 서버를 만들어 oauth를 직접 구현해봤다. 확실히 직접 구현해보니 내가 어느 부분에서 헷갈려했는지 정리할 수 있었다. 또한, 내가 이해한 부분과 백앤드분들이 이해한 부분을 맞추면서 구현하다보니 시간은 좀 걸렸지만 예상치 못한 버그나 수정사항이 생겼을 때 더욱 빠르게 해결할 수 있었다.

## 서버상태관리필요성 - 서버상태 최신화

우리가 만들려는 서비스는 정적사이트가 아닌 was를 이용한 동적으로 데이터가 변하는 사이트다. 이 때, 프론트는 UI 표현 뿐만 아니라 서버 상태를 적절하게 반영해야한다. 어떤 서버 상태의 추가/수정/삭제 작업 후 서버의 최신화된 상태를 다시 받아야와야 하는데 이를 어떻게 우하하게(?) 해결할 수 있을가 고민했다.

react-query나 swr를 활용해 조금 쉽게 접근해볼까했지만 그 전에 fetch만으로 서버상태를 적절히 반영하는 걸 시도해보고 싶었다. (어쨋든 위의 새로운 기술들도 어떤 문제를 해결하기 위해 등장했으니, 그 문제를 겪어봐야 더 와닿을 것 같았다.)

백앤드 분들과 GET/POST/DELETE/PATCH/PUT 등의 다양한 api를 설계하면서 여러 방식을 함께 고민했다. (주간 회고에 자세히 써있어서 여기선 생략하겠다.)

상태관리라고 하면 로컬 상태만 떠올렸는데, 서버 상태도 중요하다는 걸 이번에 공부하면서 느꼈다. (오히려 이번 프로젝트 같은 경우 로컬 상태는 거의 없었다.)

## 로그인 유지

로그인 기능이 없는 서비스를 찾아보기 힘들다. 마지막 프로젝트에서는 기능 구현보다는 로그인 및 유지 기능을 확실히 이해하고 싶었다.

token으로 로그인을 유지하는 기능을 구현했는데 다음과 같은 부분에서 어려움을 겪었다.

1. 로그인 유저 정보를 어디서 들고 있을까?

프로필 이미지, 아이디, 닉네임과 같은 탈취되어도 큰 문제가 안 일어날 것 같은 정보들을 어디서 들고 있을까?

처음에는 localstorage에 넣어 둘까했지만 token을 localstorage(혹은 쿠키)에서 들고 있기 때문에 해당 정보는 브라우저에서 기억할 필요 없이 token을 활용해 필요할 때마다 api로 요청하면 되지 않을까 싶었다.

1. 로그인 여부 판단

private route를 구현할 때 로그인 여부를 판단하는 기준을 무엇을 할까 고민했다. 특정 유저 정보를 기준으로 해야할지, refresh token의 만료시간을 기준으로 할지, GET: user/info의 올바른 응답 값을 기준으로할지 판단하기 어려웠다.

GET: user/info를 기준으로한다면 (react에서 컴포넌트 렌더링 → useEffect 내부의 effect로 사용자 정보 요청 → 로그인 여부 업데이트 후 컴포넌트 리렌더링) 흐름처럼 api 요청으로 인해 페이지 전체가 리렌더링이 일어나는 문제가 있었다.

대안으로 브라우저에서 기억하고 있는 refersh token의 만료시간을 기준으로 로그인 여부를 확인했다. 하지만 이 방법 또한 다음과 같은 문제가 있었다.

- local storage에 있는 refresh token을 탈취되기 쉬움
- cookie httpOnly옵션으로 들어있다면 프론트에서 만료시간을 확인할 수 없다.
